var ZiggeoSdk={init:function(a,b,c){ZiggeoSdk.Config.token=a,ZiggeoSdk.Config.private_key=b,ZiggeoSdk.Config.encryption_key=c}};module.exports=ZiggeoSdk,ZiggeoSdk.Config={local:!1,server_api_url:"srvapi.ziggeo.com"},ZiggeoSdk.Connect={__options:function(a,b,c){c=c||{};var d={host:c.host?c.host:ZiggeoSdk.Config.server_api_url,ssl:"ssl"in c?c.ssl:!ZiggeoSdk.Config.local,path:b,method:a,headers:{}};"auth"in c&&!c.auth||(d.headers.Authorization="Basic "+new Buffer(ZiggeoSdk.Config.token+":"+ZiggeoSdk.Config.private_key).toString("base64"));var e=d.host.indexOf(":");return e>=0&&(d.port=d.host.substr(e+1),d.host=d.host.substr(0,e)),d},__http:require("http"),__https:require("https"),__querystring:require("querystring"),__fs:require("fs"),requestChunks:function(a,b,c,d,e,f,g){var h=this.__options(a,b,f),i=null;d&&("GET"==a?h.path=h.path+"?"+this.__querystring.stringify(d):(i=this.__querystring.stringify(d),i.length>0&&(h.headers["Content-Type"]="application/x-www-form-urlencoded",h.headers["Content-Length"]=i.length)));var j=h.ssl?this.__https:this.__http,k=j.request(h,function(a){var b=[];a.on("data",function(a){b.push(a)}).on("end",function(){g&&(b=g(b)),a.statusCode>=200&&a.statusCode<300?c&&(c.success?c.success(b):c(b)):c.failure&&c.failure(b)})});if(e){var l=Math.random().toString(16);k.setHeader("Content-Type",'multipart/form-data; boundary="'+l+'"'),k.write("--"+l+'\r\nContent-Type: application/octet-stream\r\nContent-Disposition: form-data; name="file"; filename="'+e.replace(/^.*[\\\/]/,"")+'"\r\nContent-Transfer-Encoding: binary\r\n\r\n'),this.__fs.createReadStream(e,{bufferSize:4096}).on("end",function(){k.end("\r\n--"+l+"--")}).pipe(k,{end:!1})}else i&&i.length>0&&k.write(i),k.end()},requestBinary:function(a,b,c,d,e,f){return this.requestChunks(a,b,c,d,e,f,function(a){return Buffer.concat(a)})},request:function(a,b,c,d,e,f){return this.requestChunks(a,b,c,d,e,f,function(a){return a.join("")})},requestJSON:function(a,b,c,d,e,f){return this.requestChunks(a,b,c,d,e,f,function(a){return JSON.parse(a.join(""))})},getBinary:function(a,b,c){this.requestBinary("GET",a,b,c)},get:function(a,b,c){this.request("GET",a,b,c)},getJSON:function(a,b,c){this.requestJSON("GET",a,b,c)},destroy:function(a,b,c){this.request("DELETE",a,b,c)},destroyJSON:function(a,b,c){this.requestJSON("DELETE",a,b,c)},post:function(a,b,c,d){this.request("POST",a,b,c,d)},postJSON:function(a,b,c,d,e){this.requestJSON("POST",a,b,c,d,e)}},ZiggeoSdk.Auth={__encrypt:function(a){var b=require("crypto"),c=b.createHash("md5");c.update(ZiggeoSdk.Config.encryption_key);var d=c.digest("hex"),e=b.randomBytes(8).toString("hex"),f=b.createCipheriv("aes-256-cbc",d,e);f.setAutoPadding(!0);var g=f.update(a,"binary","hex")+f["final"]("hex");return e+g},generate:function(a){return data=a||{},data.application_token=ZiggeoSdk.Config.token,data.nonce=this.__generateNonce(),this.__encrypt(JSON.stringify(data))},__generateNonce:function(){var a=new Date;return a.getTime()+""+Math.floor(Math.random()*(Math.pow(2,32)-1))}},ZiggeoSdk.Videos={index:function(a,b){ZiggeoSdk.Connect.getJSON("/v1/videos/",b,a)},get:function(a,b){ZiggeoSdk.Connect.getJSON("/v1/videos/"+a,b)},download_video:function(a,b){ZiggeoSdk.Connect.getBinary("/v1/videos/"+a+"/video",b)},download_image:function(a,b){ZiggeoSdk.Connect.getBinary("/v1/videos/"+a+"/image",b)},update:function(a,b,c){ZiggeoSdk.Connect.postJSON("/v1/videos/"+a,c,b)},destroy:function(a,b){ZiggeoSdk.Connect.destroy("/v1/videos/"+a,b)},create:function(a,b){var c=null;a&&a.file&&(c=a.file,delete a.file),ZiggeoSdk.Connect.postJSON("/v1/videos/",b,a,c)}},ZiggeoSdk.Streams={index:function(a,b,c){ZiggeoSdk.Connect.getJSON("/v1/videos/"+a+"/streams",c,b)},get:function(a,b,c){ZiggeoSdk.Connect.getJSON("/v1/videos/"+a+"/streams/"+b,c)},download_video:function(a,b,c){ZiggeoSdk.Connect.getBinary("/v1/videos/"+a+"/streams/"+b+"/video",c)},download_image:function(a,b,c){ZiggeoSdk.Connect.getBinary("/v1/videos/"+a+"/streams/"+b+"/image",c)},destroy:function(a,b,c){ZiggeoSdk.Connect.destroy("/v1/videos/"+a+"/streams/"+b,c)},create:function(a,b,c){var d=null;b&&b.file&&(d=b.file,delete b.file),ZiggeoSdk.Connect.postJSON("/v1/videos/"+a+"/streams",c,b,d)}},ZiggeoSdk.Authtokens={get:function(a,b){ZiggeoSdk.Connect.getJSON("/v1/authtokens/"+a,b)},update:function(a,b,c){ZiggeoSdk.Connect.postJSON("/v1/authtokens/"+a,c,b)},destroy:function(a,b){ZiggeoSdk.Connect.destroy("/v1/authtokens/"+a,b)},create:function(a,b){ZiggeoSdk.Connect.postJSON("/v1/authtokens/",b,a)}};